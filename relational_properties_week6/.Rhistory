# pair each anchor occurrence with every token in the document
# then, calculate the distances between them
windows <- anchor_hits %>%
#join each anchor occurrence to ALL tokens in the same doc
left_join(
tokens,
by = "doc_title",
relationship = "many-to-many"
) %>%
# compute how far each token is from the anchor
# negative distance = to the LEFT of the anchor
# positive distance = to the RIGHT of the anchor
mutate(distance = token_id - anchor_id) %>%
#keep only tokens within the window size
filter(abs(distance) <= window_size) %>%
filter(distance != 0) %>% #remove the anchor word itself (i.e. keep context words only)
mutate(
window_id = paste0(
doc_title,
"_",
anchor_id),
anchor_word = anchor
) %>%
select(
doc_title,
window_id,
anchor_word,
anchor_id,
token_id,
distance,
word
)
install.packages('parallel')
